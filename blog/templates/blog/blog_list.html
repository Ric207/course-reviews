{% extends "base.html" %}

{% block title %}Career Insights Blog{% endblock %}

{% block content %}
<div class="container mt-5">
    
    <!-- HERO SECTION -->
    <div class="text-center mb-5">
        <h1 class="fw-bold display-5 text-dark">Career Insights & <span class="text-primary">Secrets</span></h1>
        <p class="lead text-muted">
            Exclusive guides on KUCCPS placement, high-paying degrees, and university survival hacks.
        </p>
        
        <!-- Filter Tags -->
        <div class="d-flex justify-content-center flex-wrap gap-2 mt-3">
            <a href="{% url 'blog_list' %}" class="btn btn-sm btn-outline-dark rounded-pill {% if not category %}active{% endif %}">All</a>
            <a href="?category=Career Advice" class="btn btn-sm btn-outline-primary rounded-pill {% if category == 'Career Advice' %}active{% endif %}">Career Advice</a>
            <a href="?category=University News" class="btn btn-sm btn-outline-success rounded-pill {% if category == 'University News' %}active{% endif %}">Uni News</a>
            <a href="?category=KUCCPS Updates" class="btn btn-sm btn-outline-warning text-dark rounded-pill {% if category == 'KUCCPS Updates' %}active{% endif %}">KUCCPS</a>
        </div>
    </div>

    {% if posts %}
        <div class="row g-4">
            {% for post in posts %}
                <div class="col-md-4">
                    <div class="card h-100 border-0 shadow-sm hover-card position-relative overflow-hidden">
                        
                        <!-- PREMIUM BADGE (If not paid) -->
                        {% if not has_full_access %}
                        <div class="position-absolute top-0 end-0 bg-warning text-dark px-3 py-1 fw-bold small rounded-bottom-start shadow-sm" style="z-index: 2;">
                            <i class="bi bi-star-fill"></i> Premium
                        </div>
                        {% endif %}

                        <!-- Card Image (Placeholder if none) -->
                        <div class="bg-light d-flex align-items-center justify-content-center text-secondary position-relative" style="height: 180px; overflow: hidden;">
                            {% if post.image %}
                                <img src="{{ post.image.url }}" class="img-fluid w-100 h-100 object-fit-cover" alt="{{ post.title }}">
                            {% else %}
                                <!-- Dynamic background color based on category for visual variety -->
                                <div class="w-100 h-100 d-flex align-items-center justify-content-center" 
                                     style="background-color: {% cycle '#e3f2fd' '#e8f5e9' '#fff3e0' '#f3e5f5' %};">
                                    <i class="bi bi-journal-richtext display-4 opacity-50 text-dark"></i>
                                </div>
                            {% endif %}
                        </div>

                        <div class="card-body d-flex flex-column p-4">
                            <!-- Meta Data -->
                            <div class="d-flex justify-content-between align-items-center mb-2 small text-muted">
                                <span class="text-uppercase fw-bold text-primary" style="font-size: 0.75rem;">{{ post.category }}</span>
                                <span>{{ post.created_at|date:"M d" }}</span>
                            </div>

                            <!-- Title -->
                            <h5 class="card-title fw-bold mb-3">
                                <a href="{% url 'blog_detail' post.id %}" class="text-decoration-none text-dark stretched-link">
                                    {{ post.title }}
                                </a>
                            </h5>

                            <!-- Teaser Text with Fade -->
                            <div class="card-text text-muted flex-grow-1 position-relative" style="height: 4.5em; overflow: hidden;">
                                {{ post.content|striptags }}
                                <!-- Fade Overlay -->
                                <div class="position-absolute bottom-0 start-0 w-100" 
                                      style="height: 2.5em; background: linear-gradient(to bottom, transparent, white);"></div>
                            </div>

                            <!-- Action Button -->
                            <div class="mt-3" style="position: relative; z-index: 3;"> 
                                <!-- z-index ensures button is clickable over stretched-link -->
                                {% if has_full_access %}
                                    <a href="{% url 'blog_detail' post.id %}" class="btn btn-outline-primary btn-sm w-100 rounded-pill fw-bold">
                                        Read Article <i class="bi bi-arrow-right ms-1"></i>
                                    </a>
                                {% else %}
                                    <a href="{% url 'blog_detail' post.id %}" class="btn btn-dark btn-sm w-100 rounded-pill fw-bold">
                                        <i class="bi bi-lock-fill text-warning me-1"></i> Unlock Full Story
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-light text-center p-5 border shadow-sm">
            <div class="mb-3">
                <i class="bi bi-inbox display-4 text-muted"></i>
            </div>
            <h4>No articles found.</h4>
            <p class="text-muted">We are curating new content for this category. Check back soon!</p>
            <a href="{% url 'blog_list' %}" class="btn btn-outline-primary btn-sm mt-2">View All Posts</a>
        </div>
    {% endif %}
</div>

<style>
    .hover-card { 
        transition: transform 0.2s ease, box-shadow 0.2s ease; 
    }
    .hover-card:hover { 
        transform: translateY(-5px); 
        box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important; 
    }
    .object-fit-cover { 
        object-fit: cover; 
    }
</style>
{% endblock %}